From dacee765384635eac3742351de64cdae23d25194 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?St=C3=A9phane=20Graber?= <stgraber@stgraber.org>
Date: Thu, 17 Jul 2025 01:07:58 +0200
Subject: [PATCH] incusd/instance_logs: Perform stricter path validation
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: St√©phane Graber <stgraber@stgraber.org>
---
 cmd/incusd/instance_logs.go | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/cmd/incusd/instance_logs.go b/cmd/incusd/instance_logs.go
index 52439de5428..b49e8005b2b 100644
--- a/cmd/incusd/instance_logs.go
+++ b/cmd/incusd/instance_logs.go
@@ -637,6 +637,11 @@ func instanceExecOutputDelete(d *Daemon, r *http.Request) response.Response {
 }
 
 func validLogFileName(fname string) bool {
+	// Make sure that there's nothing fishy about the provided file name.
+	if filepath.Base(fname) != fname {
+		return false
+	}
+
 	/* Let's just require that the paths be relative, so that we don't have
 	 * to deal with any escaping or whatever.
 	 */
